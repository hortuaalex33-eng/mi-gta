<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>MI GTA PRO MAX FASE FINAL üòàüî•</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; overflow:hidden; background:#111; }
canvas { display:block; }

#joystickBase {
  position:absolute; bottom:40px; left:40px;
  width:140px; height:140px;
  background:rgba(255,255,255,0.1);
  border-radius:50%;
}
#joystick {
  position:absolute;
  width:70px; height:70px;
  background:cyan;
  border-radius:50%;
  left:35px; top:35px;
}

#shootBtn, #carBtn {
  position:absolute;
  right:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
}

#shootBtn {
  bottom:60px;
  width:80px; height:80px;
  background:red;
  border-radius:50%;
}
#carBtn {
  bottom:160px;
  width:80px; height:50px;
  background:#0af;
  border-radius:10px;
}

#money, #hp, #mission {
  position:absolute;
  left:20px;
  font-weight:bold;
}
#money { top:20px; color:#0f0; }
#hp { top:50px; color:red; }
#mission { top:80px; color:white; }
</style>
</head>

<body>

<div id="joystickBase"><div id="joystick"></div></div>
<div id="shootBtn">FIRE</div>
<div id="carBtn">CAR</div>
<div id="money">$0</div>
<div id="hp">‚ù§Ô∏è100</div>
<div id="mission">üéØ $100</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight;

// MUNDO
let world = { width:3000, height:3000 };
let camera = { x:0, y:0 };

// PLAYER
let player = { x:1500,y:1500,size:30,speed:220,inCar:false };

// CARRO PRO üöó
let car = { x:1600,y:1500,width:60,height:30,speed:420,angle:0 };

// ESTADO
let money=0, health=100;
let message="", messageTime=0;

// MISIONES üéØ
let mission = { goal:100, reward:200, active:true };

// ENTIDADES
let npcs=[], bullets=[], particles=[];

for(let i=0;i<8;i++){
  npcs.push({x:Math.random()*3000,y:Math.random()*3000,size:25});
}

// JOYSTICK PRO
let joystick=document.getElementById("joystick");
let base=document.getElementById("joystickBase");
let dragging=false,inputX=0,inputY=0;

base.addEventListener("touchstart",()=>dragging=true);
base.addEventListener("touchmove",e=>{
  let t=e.touches[0], r=base.getBoundingClientRect();
  let x=t.clientX-r.left-70, y=t.clientY-r.top-70;
  let d=Math.hypot(x,y), max=50;
  if(d>max){x=(x/d)*max;y=(y/d)*max;}
  joystick.style.left=(x+35)+"px";
  joystick.style.top=(y+35)+"px";
  inputX=x/max; inputY=y/max;
});
base.addEventListener("touchend",()=>{
  dragging=false; inputX=0; inputY=0;
  joystick.style.left="35px"; joystick.style.top="35px";
});

// ENTRAR CARRO
document.getElementById("carBtn").onclick=()=>{
  let d=Math.hypot(player.x-car.x,player.y-car.y);
  if(d<80) player.inCar=!player.inCar;
};

// DISPARO
document.getElementById("shootBtn").onclick=()=>{
  let len=Math.hypot(inputX,inputY)||1;
  bullets.push({
    x:player.x,
    y:player.y,
    vx:(inputX/len)*600,
    vy:(inputY/len)*600
  });
};

// LOOP
let last=0;
function loop(t){
  let dt=(t-last)/1000;
  last=t;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// UPDATE
function update(dt){

  if(player.inCar){
    car.angle = Math.atan2(inputY,inputX);
    car.x+=Math.cos(car.angle)*car.speed*dt;
    car.y+=Math.sin(car.angle)*car.speed*dt;
    player.x=car.x; player.y=car.y;
  } else {
    player.x+=inputX*player.speed*dt;
    player.y+=inputY*player.speed*dt;
  }

  camera.x+=((player.x-canvas.width/2)-camera.x)*0.1;
  camera.y+=((player.y-canvas.height/2)-camera.y)*0.1;

  // balas
  bullets.forEach(b=>{
    b.x+=b.vx*dt;
    b.y+=b.vy*dt;
  });

  // colisiones
  for(let bi=bullets.length-1;bi>=0;bi--){
    for(let ni=npcs.length-1;ni>=0;ni--){
      if(hit(bullets[bi],npcs[ni])){
        npcs.splice(ni,1);
        bullets.splice(bi,1);
        money+=10;
      }
    }
  }

  // misi√≥n
  if(mission.active && money>=mission.goal){
    mission.active=false;
    money+=mission.reward;
    message="üéâ +" + mission.reward;
    messageTime=2;

    setTimeout(()=>{
      mission.goal+=100;
      mission.reward+=150;
      mission.active=true;
    },1000);
  }

  document.getElementById("money").innerText="$"+money;
  document.getElementById("hp").innerText="‚ù§Ô∏è"+Math.floor(health);
  document.getElementById("mission").innerText="üéØ $"+mission.goal;

  if(messageTime>0) messageTime-=dt;
}

// DRAW
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // MAPA TIPO CIUDAD üó∫Ô∏è
  ctx.fillStyle="#2f2f2f";
  ctx.fillRect(-camera.x,1400-camera.y,3000,200); // calle horizontal
  ctx.fillRect(1400-camera.x,-camera.y,200,3000); // calle vertical

  // ROTONDA
  ctx.beginPath();
  ctx.arc(1500-camera.x,1500-camera.y,120,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="#7ec850";
  ctx.beginPath();
  ctx.arc(1500-camera.x,1500-camera.y,60,0,Math.PI*2);
  ctx.fill();

  // PLAYER
  ctx.fillStyle="cyan";
  ctx.fillRect(player.x-camera.x,player.y-camera.y,30,30);

  // CARRO üöó
  ctx.save();
  ctx.translate(car.x-camera.x,car.y-camera.y);
  ctx.rotate(car.angle);
  ctx.fillStyle="blue";
  ctx.fillRect(-30,-15,60,30);
  ctx.restore();

  // NPC
  ctx.fillStyle="orange";
  npcs.forEach(n=>{
    ctx.fillRect(n.x-camera.x,n.y-camera.y,25,25);
  });

  // BALAS
  ctx.fillStyle="yellow";
  bullets.forEach(b=>{
    ctx.fillRect(b.x-camera.x,b.y-camera.y,5,5);
  });

  // MENSAJE
  if(messageTime>0){
    ctx.fillStyle="white";
    ctx.font="30px Arial";
    ctx.fillText(message, canvas.width/2-100,100);
  }
}

function hit(a,b){
  return a.x<b.x+b.size &&
         a.x+5>b.x &&
         a.y<b.y+b.size &&
         a.y+5>b.y;
}
</script>

</body>
</html>
