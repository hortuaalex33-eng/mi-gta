<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>MI GTA PRO MAX FASE 8 ðŸ˜ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; overflow:hidden; background:#111; font-family:Arial; }

canvas { display:block; }

#menu {
 position:absolute; inset:0;
 background:#000;
 display:flex;
 flex-direction:column;
 align-items:center;
 justify-content:center;
 color:white;
}

#menu button{
 padding:15px 30px;
 font-size:20px;
 margin-top:20px;
}

#ui{
 position:absolute; top:10px; left:10px; color:white;
 font-weight:bold;
}

#weaponBtn{
 position:absolute; bottom:260px; right:40px;
 width:80px; height:50px;
 background:purple;
 color:white;
 display:flex;
 align-items:center;
 justify-content:center;
 border-radius:10px;
}

#joystickBase {
 position:absolute; bottom:40px; left:40px;
 width:140px; height:140px;
 background:rgba(255,255,255,0.1);
 border-radius:50%;
}

#joystick {
 position:absolute;
 width:70px; height:70px;
 background:cyan;
 border-radius:50%;
 left:35px; top:35px;
}

#shootBtn {
 position:absolute; bottom:60px; right:40px;
 width:80px; height:80px;
 background:red;
 border-radius:50%;
 display:flex; align-items:center; justify-content:center;
 color:white;
}

#carBtn {
 position:absolute; bottom:160px; right:40px;
 width:80px; height:50px;
 background:#0af;
 border-radius:10px;
 display:flex; align-items:center; justify-content:center;
 color:white;
}
</style>
</head>

<body>

<div id="menu">
<h1>ðŸ”¥ MI GTA PRO MAX ðŸ”¥</h1>
<button onclick="startGame()">JUGAR</button>
</div>

<div id="ui"></div>

<div id="joystickBase"><div id="joystick"></div></div>
<div id="shootBtn">FIRE</div>
<div id="carBtn">CAR</div>
<div id="weaponBtn">ðŸ”«</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight;

// VARIABLES
let world={width:3000,height:3000};
let camera={x:0,y:0};

let player={x:1500,y:1500,size:30,speed:220,inCar:false};
let car={x:1600,y:1500,width:60,height:30,speed:400};

let money=0,health=100,wanted=0,time=0;

let weapon="pistol";

let npcs=[], police=[], bullets=[], particles=[], cars=[], buildings=[];

// GENERAR MUNDO
for(let i=0;i<5;i++){
 npcs.push({x:Math.random()*world.width,y:Math.random()*world.height,size:25,speed:70});
}

for(let i=0;i<3;i++){
 police.push({x:Math.random()*world.width,y:Math.random()*world.height,size:28,speed:120});
}

for(let i=0;i<5;i++){
 cars.push({x:Math.random()*world.width,y:Math.random()*world.height,w:60,h:30,speed:100});
}

for(let i=0;i<15;i++){
 buildings.push({
  x:Math.random()*world.width,
  y:Math.random()*world.height,
  w:100,h:100
 });
}

// JOYSTICK
let joystick=document.getElementById("joystick");
let base=document.getElementById("joystickBase");
let dragging=false,inputX=0,inputY=0;

base.addEventListener("touchstart",()=>dragging=true);
base.addEventListener("touchmove",e=>{
 if(!dragging)return;
 let t=e.touches[0],r=base.getBoundingClientRect();
 let x=t.clientX-r.left-70,y=t.clientY-r.top-70;
 let d=Math.hypot(x,y),max=50;
 if(d>max){x=(x/d)*max;y=(y/d)*max;}
 joystick.style.left=(x+35)+"px";
 joystick.style.top=(y+35)+"px";
 inputX=x/max;inputY=y/max;
});
base.addEventListener("touchend",()=>{
 dragging=false;inputX=0;inputY=0;
 joystick.style.left="35px";joystick.style.top="35px";
});

// BOTONES
document.getElementById("weaponBtn").onclick=()=>{
 weapon = weapon==="pistol"?"shotgun":"pistol";
};

document.getElementById("carBtn").onclick=()=>{
 let d=Math.hypot(player.x-car.x,player.y-car.y);
 if(d<80) player.inCar=!player.inCar;
};

document.getElementById("shootBtn").onclick=()=>{
 if(bullets.length>30) bullets.shift();

 if(weapon==="shotgun"){
  for(let i=0;i<5;i++){
    shoot(Math.random()*0.5-0.25);
  }
 }else{
  shoot(0);
 }
};

function shoot(spread){
 let dx=inputX||1,dy=inputY||0;
 let len=Math.hypot(dx,dy)||1;

 dx+=spread;
 dy+=spread;

 bullets.push({
  x:player.x,y:player.y,
  vx:(dx/len)*600,
  vy:(dy/len)*600
 });
}

// LOOP
let last=0;
function loop(t){
 let dt=(t-last)/1000;
 if(dt<1/30){requestAnimationFrame(loop);return;}
 last=t;
 update(dt);
 draw();
 requestAnimationFrame(loop);
}

function startGame(){
 document.getElementById("menu").style.display="none";
 requestAnimationFrame(loop);
}

// UPDATE
function update(dt){
 time+=dt;

 let oldX=player.x, oldY=player.y;

 if(player.inCar){
  car.x+=inputX*car.speed*dt;
  car.y+=inputY*car.speed*dt;
  player.x=car.x; player.y=car.y;
 }else{
  player.x+=inputX*player.speed*dt;
  player.y+=inputY*player.speed*dt;
 }

 // COLISION EDIFICIOS
 buildings.forEach(b=>{
  if(player.x<b.x+b.w && player.x+30>b.x &&
     player.y<b.y+b.h && player.y+30>b.y){
    player.x=oldX;
    player.y=oldY;
  }
 });

 camera.x+=(player.x-canvas.width/2-camera.x)*0.1;
 camera.y+=(player.y-canvas.height/2-camera.y)*0.1;

 // NPC
 npcs.forEach(n=>{
  let dx=player.x-n.x,dy=player.y-n.y;
  let d=Math.hypot(dx,dy);
  if(d<200){
    n.x+=(dx/d)*n.speed*dt;
    n.y+=(dy/d)*n.speed*dt;
  }
  if(d<30) health-=20*dt;
 });

 // POLICE
 police.forEach(p=>{
  if(wanted>0){
    let dx=player.x-p.x,dy=player.y-p.y;
    let d=Math.hypot(dx,dy);
    p.x+=(dx/d)*p.speed*(1+wanted)*dt;
    p.y+=(dy/d)*p.speed*(1+wanted)*dt;
    if(d<35) health-=40*dt;
  }
 });

 // TRAFICO
 cars.forEach(c=>{
  c.x+=Math.sin(time+c.x)*c.speed*dt;
  c.y+=Math.cos(time+c.y)*c.speed*dt;
 });

 // BULLETS
 bullets.forEach(b=>{
  b.x+=b.vx*dt;
  b.y+=b.vy*dt;
 });

 // COLISION
 for(let bi=bullets.length-1;bi>=0;bi--){
  let b=bullets[bi];

  npcs.forEach((n,i)=>{
    if(hit(b,n)){
      spawnParticles(n.x,n.y);
      npcs.splice(i,1);
      bullets.splice(bi,1);
      money+=10;
      wanted+=0.2;
    }
  });

  police.forEach((p,i)=>{
    if(hit(b,p)){
      spawnParticles(p.x,p.y);
      police.splice(i,1);
      bullets.splice(bi,1);
      money+=50;
      wanted+=0.5;
    }
  });
 }

 wanted-=dt*0.05;
 if(wanted<0) wanted=0;

 if(health<=0){
  alert("ðŸ’€ GAME OVER");
  location.reload();
 }

 document.getElementById("ui").innerText=
 "ðŸ’° "+money+" | â¤ï¸ "+Math.floor(health)+" | â­ "+wanted.toFixed(1)+" | ðŸ”« "+weapon;
}

// DRAW
function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 // MAP optimizado
 for(let x=camera.x-200;x<camera.x+canvas.width+200;x+=100){
  for(let y=camera.y-200;y<camera.y+canvas.height+200;y+=100){
    ctx.strokeStyle="#222";
    ctx.strokeRect(x-camera.x,y-camera.y,100,100);
  }
 }

 // BUILDINGS
 ctx.fillStyle="#444";
 buildings.forEach(b=>{
  ctx.fillRect(b.x-camera.x,b.y-camera.y,b.w,b.h);
 });

 // TRAFICO
 ctx.fillStyle="gray";
 cars.forEach(c=>{
  ctx.fillRect(c.x-camera.x,c.y-camera.y,c.w,c.h);
 });

 // PLAYER
 ctx.fillStyle="cyan";
 ctx.fillRect(player.x-camera.x,player.y-camera.y,30,30);

 // NPC
 ctx.fillStyle="orange";
 npcs.forEach(n=>{
  ctx.fillRect(n.x-camera.x,n.y-camera.y,n.size,n.size);
 });

 // POLICE
 ctx.fillStyle="blue";
 police.forEach(p=>{
  ctx.fillRect(p.x-camera.x,p.y-camera.y,p.size,p.size);
 });

 // BULLETS
 ctx.fillStyle="yellow";
 bullets.forEach(b=>{
  ctx.fillRect(b.x-camera.x,b.y-camera.y,5,5);
 });

 // PARTICLES
 ctx.fillStyle="red";
 particles.forEach(p=>{
  ctx.fillRect(p.x-camera.x,p.y-camera.y,3,3);
  p.x+=p.vx*0.016;
  p.y+=p.vy*0.016;
  p.life-=0.016;
 });
 particles=particles.filter(p=>p.life>0);

 // MINIMAP
 ctx.fillStyle="black";
 ctx.fillRect(canvas.width-110,10,100,100);

 ctx.fillStyle="white";
 ctx.fillRect(canvas.width-110+(player.x/world.width)*100,
              10+(player.y/world.height)*100,5,5);
}

// PARTICULAS
function spawnParticles(x,y){
 for(let i=0;i<10;i++){
  particles.push({
    x,y,
    vx:(Math.random()-0.5)*200,
    vy:(Math.random()-0.5)*200,
    life:1
  });
 }
}

// HIT
function hit(a,b){
 return a.x<b.x+b.w &&
        a.x+5>b.x &&
        a.y<b.y+b.h &&
        a.y+5>b.y;
}
</script>

</body>
</html>
